<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Diagrams On Web</title>
    <meta name="description" content="Build Diagram from code in your browser." />
    <meta name="keywords" content="Diagrams web" />
    <script src="https://kit.fontawesome.com/a076d05399.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">
    <style>
        img {
        margin-bottom: 0px;
        width: 100%;
        height: auto;
        }
        .icon {
            width: 100px;
        }
        #menu-bar {
            width: 100%;
            margin-left: 10px;
            margin-top: 10px;
            margin-bottom: 15px;
        }
        #editor {
            position: relative;
            min-height: 100vh;
        }
        #diagrams_data {
            display: none;
        }
        .column {
          flex: 1 1 0%;
        }
        pre {
          white-space: pre-wrap;
        }
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  </head>
  <body id="{% block body_id %}normal_body{% endblock %}" class="m-0 p-0 w-100 h-100 d-flex flex-column">
    <form action="" method="POST" id="diagrams_form" class="m-0 d-flex">
      <div class="d-flex flex-column column">
          <textarea name="diagrams_data" id="diagrams_data" rows="0">{{diagrams_data}}</textarea>
          <div id="editor" style="position: relative">{{diagrams_data}}</div>
      </div>
      <div class="d-flex flex-column column h-100">
        <div id="menu-bar" class="m-0 d-flex">
          <button class="btn btn-primary m-2" value="Build" id="build">Build <i class="fas fa-angle-double-right"></i></button>
          <button class="btn btn-primary m-2" id="btn_1">Example <i class="round">1</i></button>
          <button class="btn btn-primary m-2" id="btn_2">Example <i class="round">2</i></button>
          <button class="btn btn-primary m-2" id="btn_3">Example <i class="round">3</i></button>
          <button class="btn btn-primary m-2" id="btn_more">More example</button>
        </div>
        {% if error %}
          <h4>ERROR</h4>
          <pre>{% autoescape false %}
            {{error}}
          {% endautoescape %}</pre>
        {% elif pic_name %}
          <img src="static/{{pic_name}}" alt="">
        {% endif %}
      </div>
    </form>
    <script src="https://unpkg.com/ace-builds@1.4.14/src-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
    
    <script id="text_1" type="bogus">
      from diagrams import Diagram
from diagrams.aws.compute import EC2
from diagrams.aws.database import RDS
from diagrams.aws.network import ELB

with Diagram("Grouped Workers", show=False, direction="TB"):
    ELB("lb") >> [EC2("worker1"),
                  EC2("worker2"),
                  EC2("worker3"),
                  EC2("worker4"),
                  EC2("worker5")] >> RDS("events")
    </script>
    <script id="text_2" type="bogus">
      from diagrams import Cluster, Diagram
from diagrams.gcp.analytics import BigQuery, Dataflow, PubSub
from diagrams.gcp.compute import AppEngine, Functions
from diagrams.gcp.database import BigTable
from diagrams.gcp.iot import IotCore
from diagrams.gcp.storage import GCS

with Diagram("Message Collecting", show=False):
    pubsub = PubSub("pubsub")

    with Cluster("Source of Data"):
        [IotCore("core1"),
         IotCore("core2"),
         IotCore("core3")] >> pubsub

    with Cluster("Targets"):
        with Cluster("Data Flow"):
            flow = Dataflow("data flow")

        with Cluster("Data Lake"):
            flow >> [BigQuery("bq"),
                     GCS("storage")]

        with Cluster("Event Driven"):
            with Cluster("Processing"):
                flow >> AppEngine("engine") >> BigTable("bigtable")

            with Cluster("Serverless"):
                flow >> Functions("func") >> AppEngine("appengine")

    pubsub >> flow
    </script>
    <script id="text_3" type="bogus">
      from diagrams import Cluster, Diagram
from diagrams.onprem.analytics import Spark
from diagrams.onprem.compute import Server
from diagrams.onprem.database import PostgreSQL
from diagrams.onprem.inmemory import Redis
from diagrams.onprem.aggregator import Fluentd
from diagrams.onprem.monitoring import Grafana, Prometheus
from diagrams.onprem.network import Nginx
from diagrams.onprem.queue import Kafka

with Diagram("Advanced Web Service with On-Premise", show=False):
    ingress = Nginx("ingress")

    metrics = Prometheus("metric")
    metrics << Grafana("monitoring")

    with Cluster("Service Cluster"):
        grpcsvc = [
            Server("grpc1"),
            Server("grpc2"),
            Server("grpc3")]

    with Cluster("Sessions HA"):
        primary = Redis("session")
        primary - Redis("replica") << metrics
        grpcsvc >> primary

    with Cluster("Database HA"):
        primary = PostgreSQL("users")
        primary - PostgreSQL("replica") << metrics
        grpcsvc >> primary

    aggregator = Fluentd("logging")
    aggregator >> Kafka("stream") >> Spark("analytics")

    ingress >> grpcsvc >> aggregator
    </script>
    <script>
        var editor = ace.edit("editor");
        editor.setTheme("ace/theme/iplastic");
        editor.session.setMode("ace/mode/python");

        $("#btn_1").click(function(){
          var text = $("#text_1").html().trim()
          editor.setValue(text);
          $("#diagrams_data").val(editor.getSession().getValue());
          $("#diagrams_form").submit();
        });
        $("#btn_2").click(function(){
          var text = $("#text_2").html().trim()
          editor.setValue(text);
          $("#diagrams_data").val(editor.getSession().getValue());
          $("#diagrams_form").submit();
        });
        $("#btn_3").click(function(){
          var text = $("#text_3").html().trim()
          editor.setValue(text);
          $("#diagrams_data").val(editor.getSession().getValue());
          $("#diagrams_form").submit();
        });
        $("#btn_more").click(function(){
          window.open("https://diagrams.mingrammer.com/docs/getting-started/examples", "_blank");
        });
        $("#build").click(function(){
          $("#diagrams_data").val(editor.getSession().getValue());
          $("#diagrams_form").submit();
        })
        if ($("#diagrams_data").val() == '') {
          var text = $("#text_1").html().trim()
          editor.setValue(text);
          $("#diagrams_data").val(editor.getSession().getValue());
        }
    </script>

  </body>
</html>