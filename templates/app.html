<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Diagrams On Web</title>
    <meta name="description" content="Build Diagram from code in your browser." />
    <meta name="keywords" content="Diagrams web" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">
    <style>
        #container {
          min-height: 100vh;
        }
        pre {
          white-space: pre-wrap;
        }
        .gutter {
            background-color: black;
            background-repeat: no-repeat;
            background-position: 50%;
        }
        .gutter.gutter-horizontal {
            background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAeCAYAAADkftS9AAAAIklEQVQoU2M4c+bMfxAGAgYYmwGrIIiDjrELjpo5aiZeMwF+yNnOs5KSvgAAAABJRU5ErkJggg==');
            cursor: col-resize;
        }
        .image-scroller {
            flex: 1 0 auto;
            position: relative;
            overflow-y: auto;
        }
        .image-scroller > * {
            flex: 1 0 auto;
            position: absolute;
            height: 100%;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/split.js@1.6.5/dist/split.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/panzoom@9.4.3/dist/panzoom.min.js"></script>
    <!-- Monaco Loader must be the last one !-->
    <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.33.0/min/vs/loader.js"></script>
  </head>
  <body class="m-0 p-0 w-100 d-flex flex-row">
    <script id="text_0" type="bogus">
      from diagrams import Diagram
from diagrams.custom import Custom
from diagrams.aws.compute import EC2
from diagrams.aws.database import RDS
from diagrams.aws.network import ELB

Arch_AWS_Batch_64 = """data:image/svg;utf8,<?xml version="1.0" encoding="UTF-8"?>
<svg width="80" height="80" viewBox="0 0 80 80" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <title>Icon-Architecture/64/Arch_AWS-Batch_64</title>
    <desc>Created with Sketch.</desc>
    <defs>
        <linearGradient x1="0%" y1="100%" x2="100%" y2="0%" id="linearGradient-1">
            <stop stop-color="#C8511B" offset="0%"></stop>
            <stop stop-color="#FF9900" offset="100%"></stop>
        </linearGradient>
    </defs>
    <g id="Icon-Architecture/64/Arch_AWS-Batch_64" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g id="Icon-Architecture-BG/64/Compute" fill="url(#linearGradient-1)">
            <rect id="Rectangle" x="0" y="0" width="80" height="80"></rect>
        </g>
        <path d="M40.2258065,58.897 C41.4647177,58.897 42.4707661,59.894 42.4707661,61.124 C42.4707661,62.354 41.4647177,63.351 40.2258065,63.351 C38.9868952,63.351 37.9808468,62.354 37.9808468,61.124 C37.9808468,59.894 38.9868952,58.897 40.2258065,58.897 M21.3014113,40.876 C21.3014113,42.106 20.2953629,43.103 19.0564516,43.103 C17.8175403,43.103 16.8114919,42.106 16.8114919,40.876 C16.8114919,39.647 17.8175403,38.649 19.0564516,38.649 C20.2953629,38.649 21.3014113,39.647 21.3014113,40.876 M61.3790323,66 C58.797379,66 56.7752016,64.066 56.7752016,61.598 C56.7752016,59.08 58.8407258,57.031 61.3790323,57.031 C63.9183468,57.031 65.983871,59.08 65.983871,61.598 C65.983871,64.066 63.9616935,66 61.3790323,66 M56.7752016,41 C56.7752016,38.482 58.8407258,36.433 61.3790323,36.433 C63.9183468,36.433 65.983871,38.482 65.983871,41 C65.983871,43.518 63.9183468,45.567 61.3790323,45.567 C58.8407258,45.567 56.7752016,43.518 56.7752016,41 M40.2258065,45.567 C37.6864919,45.567 35.6219758,43.518 35.6219758,41 C35.6219758,38.482 37.6864919,36.433 40.2258065,36.433 C42.765121,36.433 44.8296371,38.482 44.8296371,41 C44.8296371,43.518 42.765121,45.567 40.2258065,45.567 M45.266129,61 C45.266129,63.851 43.0997984,66 40.2258065,66 C37.3518145,66 35.1854839,63.851 35.1854839,61 C35.1854839,58.149 37.3518145,56 40.2258065,56 C43.0997984,56 45.266129,58.149 45.266129,61 M34.1774194,21 C34.1774194,17.86 37.0594758,15 40.2258065,15 C43.3921371,15 46.2741935,17.86 46.2741935,21 C46.2741935,24.14 43.3921371,27 40.2258065,27 C37.0594758,27 34.1774194,24.14 34.1774194,21 M19.0564516,46 C16.1824597,46 14.016129,43.851 14.016129,41 C14.016129,38.106 16.2772177,35.752 19.0564516,35.752 C21.8356855,35.752 24.0967742,38.106 24.0967742,41 C24.0967742,43.851 21.9304435,46 19.0564516,46 M23.6451613,61.564 C23.6451613,64.051 21.6229839,66 19.0403226,66 C16.4586694,66 14.4364919,64.051 14.4364919,61.564 C14.4364919,59.045 16.5020161,56.997 19.0403226,56.997 C21.5796371,56.997 23.6451613,59.045 23.6451613,61.564 M62.3870968,55.115 L62.3870968,47.482 C65.5594758,46.999 68,44.28 68,41 C68,37.379 65.0292339,34.433 61.3790323,34.433 C58.0725806,34.433 55.3316532,36.853 54.8447581,40 L46.7600806,40 C46.3235887,37.18 44.0766129,34.951 41.233871,34.518 L41.233871,28.923 C45.09375,28.397 48.2903226,24.924 48.2903226,21 C48.2903226,16.738 44.5221774,13 40.2258065,13 C35.9294355,13 32.1612903,16.738 32.1612903,21 C32.1612903,24.924 35.3578629,28.397 39.2177419,28.923 L39.2177419,34.518 C36.375,34.951 34.1280242,37.18 33.6915323,40 L26.0383065,40 C25.5604839,36.477 22.6159274,33.752 19.0564516,33.752 C15.1663306,33.752 12,37.004 12,41 C12,44.584 14.5866935,47.451 18.0483871,47.924 L18.0483871,55.079 C14.8689516,55.556 12.4203629,58.278 12.4203629,61.564 C12.4203629,65.173 15.328629,68 19.0403226,68 C22.7530242,68 25.6612903,65.173 25.6612903,61.564 C25.6612903,58.289 23.2298387,55.574 20.0645161,55.084 L20.0645161,47.924 C23.1955645,47.496 25.6048387,45.107 26.0362903,42 L33.6915323,42 C34.1280242,44.82 36.375,47.049 39.2177419,47.482 L39.2177419,54.076 C35.7560484,54.549 33.1693548,57.416 33.1693548,61 C33.1693548,64.925 36.2691532,68 40.2258065,68 C44.1824597,68 47.2822581,64.925 47.2822581,61 C47.2822581,57.416 44.6955645,54.549 41.233871,54.076 L41.233871,47.482 C44.0766129,47.049 46.3235887,44.82 46.7600806,42 L54.8447581,42 C55.2822581,44.82 57.5282258,47.049 60.3709677,47.482 L60.3709677,55.115 C57.1995968,55.599 54.7590726,58.318 54.7590726,61.598 C54.7590726,65.188 57.6673387,68 61.3790323,68 C65.0917339,68 68,65.188 68,61.598 C68,58.318 65.5594758,55.599 62.3870968,55.115" id="AWS-Batch_Icon_64_Squid" fill="#FFFFFF"></path>
    </g>
</svg>"""

Arch_AWS_Directory_Service_64 = """data:image/svg;utf8,<?xml version="1.0" encoding="UTF-8"?>
<svg width="80px" height="80px" viewBox="0 0 80 80" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <title>Icon-Architecture/64/Arch_AWS-Directory-Service_64</title>
    <desc>Created with Sketch.</desc>
    <defs>
        <linearGradient x1="0%" y1="100%" x2="100%" y2="0%" id="linearGradient-1">
            <stop stop-color="#BD0816" offset="0%"></stop>
            <stop stop-color="#FF5252" offset="100%"></stop>
        </linearGradient>
    </defs>
    <g id="Icon-Architecture/64/Arch_AWS-Directory-Service_64" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g id="Icon-Architecture-BG/64/Security-Identity-Compliance" fill="url(#linearGradient-1)">
            <rect id="Rectangle" x="0" y="0" width="80" height="80"></rect>
        </g>
        <path d="M34,51 L37,51 L37,49 L34,49 L34,51 Z M25,51 L32,51 L32,49 L25,49 L25,51 Z M25,46 L36,46 L36,44 L25,44 L25,46 Z M65,58 L65,39 L63,39 L63,53 C63,53.552 62.553,54 62,54 L42,54 C41.447,54 41,53.552 41,53 L41,39 L22,39 L22,58 L65,58 Z M44.074,52 L59.918,52 C59.48,48.983 57.178,46.284 54.152,45.325 C53.455,45.619 52.705,45.779 51.951,45.779 C51.197,45.779 50.451,45.622 49.756,45.332 C46.72,46.299 44.482,48.951 44.074,52 L44.074,52 Z M53.709,43.33 C54.872,42.699 55.594,41.494 55.594,40.185 C55.594,38.198 53.96,36.581 51.951,36.581 C49.943,36.581 48.31,38.198 48.31,40.185 C48.31,41.493 49.029,42.698 50.187,43.331 C51.268,43.918 52.613,43.926 53.709,43.33 L53.709,43.33 Z M61,33 L43,33 L43,48.75 C44.001,46.696 45.696,44.987 47.808,43.966 C46.864,42.948 46.31,41.61 46.31,40.185 C46.31,37.095 48.841,34.581 51.951,34.581 C55.062,34.581 57.594,37.095 57.594,40.185 C57.594,41.604 57.042,42.937 56.104,43.952 C58.258,44.979 59.985,46.708 61,48.787 L61,33 Z M22,28 L22,37 L41,37 L41,32 C41,31.448 41.447,31 42,31 L62,31 C62.553,31 63,31.448 63,32 L63,37 L65,37 L65,28 L22,28 Z M67,27 L67,59 C67,59.552 66.553,60 66,60 L21,60 C20.447,60 20,59.552 20,59 L20,27 C20,26.448 20.447,26 21,26 L66,26 C66.553,26 67,26.448 67,27 L67,27 Z M16,52 L18,52 L18,54 L15,54 C14.447,54 14,53.552 14,53 L14,21 C14,20.448 14.447,20 15,20 L61,20 C61.553,20 62,20.448 62,21 L62,24 L60,24 L60,22 L16,22 L16,52 Z" id="AWS-Directory-Service_Icon_64_Squid" fill="#FFFFFF"></path>
    </g>
</svg>"""

with Diagram("Grouped Workers", show=False, direction="TB", outformat="svg", embed=True):
    Custom("lb", Arch_AWS_Directory_Service_64) >> [EC2("worker1"),
                  EC2("worker2"),
                  EC2("worker3"),
                  EC2("worker4"),
                  EC2("worker5")] >> Custom("Batchs", Arch_AWS_Batch_64)
    </script>
    <script id="text_1" type="bogus">
      from diagrams import Cluster, Diagram
from diagrams.gcp.analytics import BigQuery, Dataflow, PubSub
from diagrams.gcp.compute import AppEngine, Functions
from diagrams.gcp.database import BigTable
from diagrams.gcp.iot import IotCore
from diagrams.gcp.storage import GCS

with Diagram("Message Collecting", show=False, outformat="svg", embed=True):
    pubsub = PubSub("pubsub")

    with Cluster("Source of Data"):
        [IotCore("core1"),
         IotCore("core2"),
         IotCore("core3")] >> pubsub

    with Cluster("Targets"):
        with Cluster("Data Flow"):
            flow = Dataflow("data flow")

        with Cluster("Data Lake"):
            flow >> [BigQuery("bq"),
                     GCS("storage")]

        with Cluster("Event Driven"):
            with Cluster("Processing"):
                flow >> AppEngine("engine") >> BigTable("bigtable")

            with Cluster("Serverless"):
                flow >> Functions("func") >> AppEngine("appengine")

    pubsub >> flow
    </script>
    <script id="text_2" type="bogus">
      from diagrams import Cluster, Diagram
from diagrams.onprem.analytics import Spark
from diagrams.onprem.compute import Server
from diagrams.onprem.database import PostgreSQL
from diagrams.onprem.inmemory import Redis
from diagrams.onprem.aggregator import Fluentd
from diagrams.onprem.monitoring import Grafana, Prometheus
from diagrams.onprem.network import Nginx
from diagrams.onprem.queue import Kafka

with Diagram("Advanced Web Service with On-Premise", show=False, outformat="svg", embed=True):
    ingress = Nginx("ingress")

    metrics = Prometheus("metric")
    metrics << Grafana("monitoring")

    with Cluster("Service Cluster"):
        grpcsvc = [
            Server("grpc1"),
            Server("grpc2"),
            Server("grpc3")]

    with Cluster("Sessions HA"):
        primary = Redis("session")
        primary - Redis("replica") << metrics
        grpcsvc >> primary

    with Cluster("Database HA"):
        primary = PostgreSQL("users")
        primary - PostgreSQL("replica") << metrics
        grpcsvc >> primary

    aggregator = Fluentd("logging")
    aggregator >> Kafka("stream") >> Spark("analytics")

    ingress >> grpcsvc >> aggregator
    </script>
    <wc-monaco-editor id="container" language="python" ></wc-monaco-editor>
    <div id="graph" class="d-flex flex-column vh-100">
      <div class="d-flex">
        <div class="btn btn-primary ml-1 my-1" value="Build" id="build">Build</div>
        <div class="btn btn-secondary ml-1 my-1" id="btn_0">Example 1</div>
        <div class="btn btn-secondary ml-1 my-1" id="btn_1">Example 2</div>
        <div class="btn btn-secondary ml-1 my-1" id="btn_2">Example 3</div>
        <div class="btn btn-secondary ml-1 my-1" id="btn_more">More</div>
      </div>
      <pre class="px-1" id="error"></pre>
      <div class="image-scroller"><img id="image" alt=""></div>
    </div>
    <script>
      window.Split(['#container', '#graph']);
      require.config({ paths: { 'vs': 'https://cdn.jsdelivr.net/npm/monaco-editor@0.33.0/min/vs' }});
      window.MonacoEnvironment = { getWorkerUrl: () => URL.createObjectURL(new Blob([`
        self.MonacoEnvironment = {
          baseUrl: 'https://cdn.jsdelivr.net/npm/monaco-editor@0.33.0/min'
        };
        importScripts('https://cdn.jsdelivr.net/npm/monaco-editor@0.33.0/min/vs/base/worker/workerMain.js');
      `], { type: 'text/javascript' })) };

      error = document.getElementById('error');
      image = document.getElementById('image');
      container = document.getElementById('container');
      
      require(["vs/editor/editor.main"], function () {
        function build() {
          error.style.display = 'none';
          error.innerHTML = '';
          image.src = '';
                
          diagrams_data = editor.getValue()
          var xhr = new XMLHttpRequest();
          xhr.open("POST", '/', true);
          xhr.onreadystatechange = function() {
            if (this.readyState === XMLHttpRequest.DONE && this.status === 200) {
              if (xhr.responseText && xhr.responseText.startsWith('/static')) {
                image.src = xhr.responseText;
                panzoom(image, {
                  bounds: true
                });
              } else {
                error.style.display = 'block';
                error.innerHTML = xhr.responseText;
              }
            }
          }
          xhr.send(diagrams_data);
        }

        let editor = monaco.editor.create(container, {
          value: document.getElementById('text_0').innerHTML.trim(),
          language: 'python',
          theme: 'vs-dark',
          automaticLayout: true
        });
        build();

        document.getElementById('build').onclick = build;
        document.getElementById('btn_0').onclick = function(){
          editor.setValue(document.getElementById('text_0').innerHTML.trim());
          build();
        }
        document.getElementById('btn_1').onclick = function(){
          editor.setValue(document.getElementById('text_1').innerHTML.trim());
          build();
        }
        document.getElementById('btn_2').onclick = function(){
          editor.setValue(document.getElementById('text_2').innerHTML.trim());
          build();
        }
        document.getElementById('btn_more').onclick = function(){
          window.open("https://diagrams.mingrammer.com/docs/getting-started/examples", "_blank");
        };
      });
    </script>

  </body>
</html>